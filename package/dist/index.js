'use strict';var C=require('react'),reactSlot=require('@radix-ui/react-slot'),classVarianceAuthority=require('class-variance-authority'),clsx=require('clsx'),tailwindMerge=require('tailwind-merge'),jsxRuntime=require('react/jsx-runtime'),i=require('@radix-ui/react-dialog'),W=require('@radix-ui/react-label'),lucideReact=require('lucide-react'),Ne=require('crypto');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k]}});}})}n.default=e;return Object.freeze(n)}var C__namespace=/*#__PURE__*/_interopNamespace(C);var i__namespace=/*#__PURE__*/_interopNamespace(i);var W__namespace=/*#__PURE__*/_interopNamespace(W);var Ne__default=/*#__PURE__*/_interopDefault(Ne);var ne=Object.defineProperty;var s=(e,a)=>ne(e,"name",{value:a,configurable:true});function r(...e){return tailwindMerge.twMerge(clsx.clsx(e))}s(r,"cn");var fe=classVarianceAuthority.cva("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=C__namespace.forwardRef(({className:e,variant:a,size:t,asChild:o=false,...m},y)=>jsxRuntime.jsx(o?reactSlot.Slot:"button",{className:r(fe({variant:a,size:t,className:e})),ref:y,...m}));x.displayName="Button";var k=i__namespace.Root,O=i__namespace.Trigger,U=i__namespace.Portal,pe=i__namespace.Close,I=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx(i__namespace.Overlay,{ref:t,className:r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));I.displayName=i__namespace.Overlay.displayName;var w=C__namespace.forwardRef(({className:e,children:a,...t},o)=>jsxRuntime.jsxs(U,{children:[jsxRuntime.jsx(I,{}),jsxRuntime.jsx(i__namespace.Content,{ref:o,className:r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:a})]}));w.displayName=i__namespace.Content.displayName;var z=s(({className:e,...a})=>jsxRuntime.jsx("div",{className:r("flex flex-col space-y-1.5 text-center sm:text-left",e),...a}),"DialogHeader");z.displayName="DialogHeader";var $=s(({className:e,...a})=>jsxRuntime.jsx("div",{className:r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a}),"DialogFooter");$.displayName="DialogFooter";var G=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx(i__namespace.Title,{ref:t,className:r("text-lg font-semibold leading-none tracking-tight",e),...a}));G.displayName=i__namespace.Title.displayName;var Y=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx(i__namespace.Description,{ref:t,className:r("text-sm text-muted-foreground",e),...a}));Y.displayName=i__namespace.Description.displayName;function _({paymentLink:e,buttonText:a="Pay with USDC",children:t,onPaymentComplete:o,className:m="",dialogClassName:y="",iframeHeight:P="580px",initialOpen:c=false,...E}){let[f,u]=C.useState(c);return C.useEffect(()=>{u(c);},[c]),C.useEffect(()=>{let p=s(v=>{var n;v.origin===new URL(e).origin&&((n=v.data)==null?void 0:n.type)==="payment_complete"&&(o&&o(v.data),u(false));},"handleMessage");return window.addEventListener("message",p),()=>{window.removeEventListener("message",p);}},[e,o]),jsxRuntime.jsx(jsxRuntime.Fragment,{children:jsxRuntime.jsxs(k,{open:f,onOpenChange:u,children:[jsxRuntime.jsx(O,{asChild:true,children:jsxRuntime.jsx(x,{className:m,...E,children:t||a})}),jsxRuntime.jsx(w,{className:`max-w-4xl w-full !h-[90vh] p-0 bg-background ${y}`,children:jsxRuntime.jsx("div",{className:"relative h-full flex flex-col",children:jsxRuntime.jsx("div",{className:"flex-1",children:jsxRuntime.jsx("iframe",{src:e,className:"w-full h-full border-0 rounded-md shadow-sm",style:{height:P},allow:"payment"})})})})]})})}s(_,"BraidPayButton");var B=C__namespace.forwardRef(({className:e,type:a,...t},o)=>jsxRuntime.jsx("input",{type:a,className:r("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...t}));B.displayName="Input";var M=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx(W__namespace.Root,{ref:t,className:r("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));M.displayName=W__namespace.Root.displayName;var L=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("div",{ref:t,className:r("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));L.displayName="Card";var Q=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("div",{ref:t,className:r("flex flex-col space-y-1.5 p-6",e),...a}));Q.displayName="CardHeader";var X=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("h3",{ref:t,className:r("text-2xl font-semibold leading-none tracking-tight",e),...a}));X.displayName="CardTitle";var Z=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("p",{ref:t,className:r("text-sm text-muted-foreground",e),...a}));Z.displayName="CardDescription";var H=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("div",{ref:t,className:r("p-6 pt-0",e),...a}));H.displayName="CardContent";var j=C__namespace.forwardRef(({className:e,...a},t)=>jsxRuntime.jsx("div",{ref:t,className:r("flex items-center p-6 pt-0",e),...a}));j.displayName="CardFooter";function S({paymentLinkID:e,email:a="",pollingInterval:t=5e3,verificationEndpoint:o="/api/check-payment-status",onPaymentComplete:m}){let[y,P]=C.useState({success:false,isPending:false,shouldShowSuccess:false}),[c,E]=C.useState(a),[f,u]=C.useState(false),p=C.useCallback(async()=>{try{let n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentLinkID:e,email:c})});if(!n.ok)throw new Error("Failed to check payment status");let d=await n.json(),g={success:d.success,isPending:d.isPending||!1,shouldShowSuccess:d.success&&!d.isPending,error:d.error,data:d};return P(g),g.success&&!g.isPending&&m&&(m(g),u(!1)),g}catch(n){return console.error("Error checking payment status:",n),P({success:false,isPending:false,shouldShowSuccess:false,error:n instanceof Error?n.message:"Unknown error occurred"}),u(false),null}},[e,c,o,m]);C.useEffect(()=>{let n;return f&&c&&(p(),n=setInterval(p,t)),()=>{n&&clearInterval(n);}},[f,c,p,t]);let v=C.useCallback(n=>{E(n),u(true),P({success:false,isPending:true,shouldShowSuccess:false});},[]);return {status:y,registerPayment:v,checkPaymentStatus:p,isPolling:f}}s(S,"usePaymentVerification");function te({paymentLinkID:e,paymentLink:a,productName:t,price:o,currency:m="$",onPaymentComplete:y,successMessage:P="Thank you for your purchase! Your access has been granted.",buttonText:c="Pay Now",className:E=""}){let[f,u]=C.useState(""),[p,v]=C.useState(false),[n,d]=C.useState(false),{status:g,registerPayment:oe,isPolling:re}=S({paymentLinkID:e,pollingInterval:3e3,onPaymentComplete:s(b=>{y&&y(b),d(false);},"onPaymentComplete")}),ie=s(b=>{b.preventDefault(),f&&f.includes("@")&&(oe(f),v(true),d(true));},"handleEmailSubmit"),se=s(b=>{d(b),!b&&!g.success&&v(false);},"handlePaymentModalChange");return jsxRuntime.jsxs("div",{className:E,children:[g.success&&g.shouldShowSuccess?jsxRuntime.jsx(L,{className:"w-full bg-green-50 border-green-200",children:jsxRuntime.jsx(H,{className:"pt-6",children:jsxRuntime.jsxs("div",{className:"flex flex-col items-center justify-center text-center p-4",children:[jsxRuntime.jsx(lucideReact.CheckCircle2,{className:"h-16 w-16 text-green-500 mb-4"}),jsxRuntime.jsx("h2",{className:"text-xl font-semibold text-green-800",children:P})]})})}):jsxRuntime.jsx(L,{className:"w-full",children:jsxRuntime.jsx(H,{className:"pt-6",children:jsxRuntime.jsxs("div",{className:"space-y-4",children:[jsxRuntime.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntime.jsx("h3",{className:"text-xl font-medium",children:t}),jsxRuntime.jsxs("div",{className:"text-xl font-bold",children:[m,o]})]}),p?jsxRuntime.jsxs("div",{className:"space-y-4",children:[jsxRuntime.jsx("div",{className:"bg-blue-50 p-3 rounded-md text-blue-800 text-sm",children:re?"We're waiting to confirm your payment. This dialog will automatically update when your payment is processed.":"Click the button below to complete your payment."}),jsxRuntime.jsx(x,{onClick:()=>d(true),className:"w-full",children:c})]}):jsxRuntime.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[jsxRuntime.jsxs("div",{className:"space-y-2",children:[jsxRuntime.jsx(M,{htmlFor:"email",children:"Email"}),jsxRuntime.jsx(B,{id:"email",type:"email",placeholder:"youremail@example.com",required:true,value:f,onChange:b=>u(b.target.value)})]}),jsxRuntime.jsx(x,{type:"submit",className:"w-full",children:"Continue to Payment"})]})]})})}),jsxRuntime.jsx(k,{open:n,onOpenChange:se,children:jsxRuntime.jsx(w,{className:"max-w-4xl w-full !h-[90vh] p-0 bg-background",children:jsxRuntime.jsx("div",{className:"relative h-full flex flex-col",children:jsxRuntime.jsx("div",{className:"flex-1",children:jsxRuntime.jsx("iframe",{src:a,className:"w-full h-full border-0 rounded-md shadow-sm",allow:"payment"})})})})})]})}s(te,"PaymentForm");function ae(e,a,t,o){let m=Ne__default.default.createHmac("sha256",e).update(`${a}${t}`).digest("hex");return o===m}s(ae,"verifyWebhookSignature");async function Ce(e,a,t){try{if(!ae(t.webhookSecret,e.toAddress,e.amount,a))throw new Error("Invalid webhook signature");return e.status==="COMPLETED"&&t.onCompleted?await t.onCompleted(e):e.status==="PENDING"&&t.onPending&&await t.onPending(e),{success:!0}}catch(o){return t.onError&&o instanceof Error&&t.onError(o),{success:false,error:o instanceof Error?o.message:"Unknown error"}}}s(Ce,"processBraidPayWebhook");exports.BraidPayButton=_;exports.Button=x;exports.Card=L;exports.CardContent=H;exports.CardDescription=Z;exports.CardFooter=j;exports.CardHeader=Q;exports.CardTitle=X;exports.Dialog=k;exports.DialogClose=pe;exports.DialogContent=w;exports.DialogDescription=Y;exports.DialogFooter=$;exports.DialogHeader=z;exports.DialogOverlay=I;exports.DialogPortal=U;exports.DialogTitle=G;exports.DialogTrigger=O;exports.Input=B;exports.Label=M;exports.PaymentForm=te;exports.cn=r;exports.processBraidPayWebhook=Ce;exports.usePaymentVerification=S;exports.verifyWebhookSignature=ae;//# sourceMappingURL=index.js.map
//# sourceMappingURL=index.js.map