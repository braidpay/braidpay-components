{"version":3,"sources":["../BraidPayButton.tsx","../utils/cn.ts","../ui/button.tsx","../ui/dialog.tsx","../PaymentForm.tsx","../ui/input.tsx","../ui/label.tsx","../ui/card.tsx","../hooks/usePaymentVerification.ts","../webhook-handler.ts"],"names":["cn","inputs","twMerge","clsx","__name","buttonVariants","cva","Button","V","className","variant","size","asChild","props","ref","jsx","Slot","Dialog","i","DialogTrigger","DialogPortal","DialogClose","DialogOverlay","T","DialogContent","children","jsxs","DialogHeader","DialogFooter","DialogTitle","DialogDescription","BraidPayButton","paymentLink","buttonText","onPaymentComplete","dialogClassName","iframeHeight","initialOpen","buttonProps","isPaymentModalOpen","setIsPaymentModalOpen","useState","useEffect","handleMessage","event","_a","Fragment","Input","q","type","Label","K","W","Card","C","CardHeader","CardTitle","CardDescription","CardContent","CardFooter","usePaymentVerification","paymentLinkID","initialEmail","pollingInterval","verificationEndpoint","status","setStatus","email","setEmail","isPolling","setIsPolling","checkPaymentStatus","useCallback","response","data","newStatus","error","intervalId","registerPayment","newEmail","PaymentForm","productName","price","currency","successMessage","isEmailSubmitted","setIsEmailSubmitted","handleEmailSubmit","e","handlePaymentModalChange","open","CheckCircle2","verifyWebhookSignature","webhookSecret","toAddress","amount","signature","expectedSignature","crypto","processBraidPayWebhook","payload","options"],"mappings":"46BAGA,IAAA,EAAA,CAAA,MAAA,CAAA,cAAA,CAAA,IAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,GAAA,EAAA,CAAA,CAAA,CAAA,MAAA,CAAA,CAAA,KAAA,CAAA,CAAA,CAAA,YAAA,CAAA,IAAA,CAAA,CAAA,CCAO,SAASA,KAAMC,CAAsB,CAAA,CAC1C,OAAOC,qBAAQC,CAAAA,SAAAA,CAAKF,CAAM,CAAC,CAC7B,CAFgBG,CAAAJ,CAAAA,CAAAA,CAAA,MCEVK,IAAAA,EAAAA,CAAiBC,0BACrB,CAAA,wRAAA,CACA,CACE,QAAU,CAAA,CACR,QAAS,CACP,OAAA,CAAS,yDACT,WACE,CAAA,oEAAA,CACF,OACE,CAAA,gFAAA,CACF,UACE,8DACF,CAAA,KAAA,CAAO,+CACP,IAAM,CAAA,iDACR,EACA,IAAM,CAAA,CACJ,OAAS,CAAA,gBAAA,CACT,GAAI,qBACJ,CAAA,EAAA,CAAI,uBACJ,IAAM,CAAA,WACR,CACF,CACA,CAAA,eAAA,CAAiB,CACf,OAAS,CAAA,SAAA,CACT,KAAM,SACR,CACF,CACF,CAQMC,CAAAA,CAAAA,CAAeC,wBACnB,CAAC,CAAE,SAAAC,CAAAA,CAAAA,CAAW,QAAAC,CAAS,CAAA,IAAA,CAAAC,EAAM,OAAAC,CAAAA,CAAAA,CAAU,MAAO,GAAGC,CAAM,CAAGC,CAAAA,CAAAA,GAGtDC,eAFWH,CAAUI,CAAAA,cAAAA,CAAO,SAE3B,CACC,SAAA,CAAWhB,EAAGK,EAAe,CAAA,CAAE,OAAAK,CAAAA,CAAAA,CAAS,KAAAC,CAAM,CAAA,SAAA,CAAAF,CAAU,CAAC,CAAC,EAC1D,GAAKK,CAAAA,CAAAA,CACJ,GAAGD,CACN,CAAA,CAGN,EACAN,CAAO,CAAA,WAAA,CAAc,SChDfU,IAAAA,CAAAA,CAAyBC,kBAEzBC,CAAgC,CAAAD,YAAA,CAAA,OAAA,CAEhCE,CAA+B,CAAAF,YAAA,CAAA,MAAA,CAE/BG,GAA8BH,YAE9BI,CAAAA,KAAAA,CAAAA,CAAAA,CAAsBC,wBAG1B,CAAC,CAAE,UAAAd,CAAW,CAAA,GAAGI,CAAM,CAAA,CAAGC,IAC1BC,cAAiB,CAAAG,YAAA,CAAA,OAAA,CAAhB,CACC,GAAKJ,CAAAA,CAAAA,CACL,UAAWd,CACT,CAAA,wJAAA,CACAS,CACF,CACC,CAAA,GAAGI,EACN,CACD,EACDS,EAAc,WAA8B,CAAAJ,YAAA,CAAA,OAAA,CAAQ,YAE9CM,IAAAA,CAAAA,CAAsBD,YAG1B,CAAA,UAAA,CAAA,CAAC,CAAE,SAAAd,CAAAA,CAAAA,CAAW,SAAAgB,CAAU,CAAA,GAAGZ,CAAM,CAAGC,CAAAA,CAAAA,GACpCY,eAACN,CAAAA,CAAAA,CAAA,CACC,QAAAL,CAAAA,CAAAA,cAAAA,CAACO,EAAA,EAAc,CAAA,CACfP,eAAiBG,YAAhB,CAAA,OAAA,CAAA,CACC,GAAKJ,CAAAA,CAAAA,CACL,UAAWd,CACT,CAAA,6fAAA,CACAS,CACF,CACC,CAAA,GAAGI,EAEH,QAAAY,CAAAA,CAAAA,CACH,GACF,CACD,EACDD,EAAc,WAA8B,CAAAN,YAAA,CAAA,OAAA,CAAQ,YAE9CS,IAAAA,CAAAA,CAAevB,EAAA,CAAC,CACpB,SAAAK,CAAAA,CAAAA,CACA,GAAGI,CACL,CAAA,GACEE,eAAC,KACC,CAAA,CAAA,SAAA,CAAWf,EACT,oDACAS,CAAAA,CACF,CACC,CAAA,GAAGI,EACN,CAVmB,CAAA,cAAA,EAYrBc,EAAa,WAAc,CAAA,cAAA,KAErBC,CAAexB,CAAAA,CAAAA,CAAA,CAAC,CACpB,UAAAK,CACA,CAAA,GAAGI,CACL,CACEE,GAAAA,cAAAA,CAAC,OACC,SAAWf,CAAAA,CAAAA,CACT,gEACAS,CACF,CAAA,CACC,GAAGI,CACN,CAAA,CAAA,CAVmB,gBAYrBe,CAAa,CAAA,WAAA,CAAc,eAErBC,IAAAA,CAAAA,CAAoBN,YAGxB,CAAA,UAAA,CAAA,CAAC,CAAE,SAAAd,CAAAA,CAAAA,CAAW,GAAGI,CAAM,CAAA,CAAGC,IAC1BC,cAAiB,CAAAG,YAAA,CAAA,KAAA,CAAhB,CACC,GAAA,CAAKJ,EACL,SAAWd,CAAAA,CAAAA,CACT,oDACAS,CACF,CAAA,CACC,GAAGI,CACN,CAAA,CACD,EACDgB,CAAAA,CAAY,YAA8BX,YAAM,CAAA,KAAA,CAAA,WAAA,KAE1CY,CAA0B,CAAAP,YAAA,CAAA,UAAA,CAG9B,CAAC,CAAE,SAAA,CAAAd,EAAW,GAAGI,CAAM,EAAGC,CAC1BC,GAAAA,cAAAA,CAAiBG,yBAAhB,CACC,GAAA,CAAKJ,EACL,SAAWd,CAAAA,CAAAA,CAAG,+BAAiCS,CAAAA,CAAS,EACvD,GAAGI,CAAAA,CACN,CACD,EACDiB,CAAAA,CAAkB,YAA8BZ,YAAY,CAAA,WAAA,CAAA,WAAA,CH7D7C,SAARa,EAAgC,CACrC,WAAA,CAAAC,CACA,CAAA,UAAA,CAAAC,EAAa,eACb,CAAA,QAAA,CAAAR,EACA,iBAAAS,CAAAA,CAAAA,CACA,UAAAzB,CAAY,CAAA,EAAA,CACZ,gBAAA0B,CAAkB,CAAA,EAAA,CAClB,aAAAC,CAAe,CAAA,OAAA,CACf,YAAAC,CAAc,CAAA,KAAA,CACd,GAAGC,CACL,CAAA,CAAwB,CACtB,GAAM,CAACC,CAAoBC,CAAAA,CAAqB,EAAIC,UAASJ,CAAAA,CAAW,EAGxE,OAAAK,WAAAA,CAAU,IAAM,CACdF,EAAsBH,CAAW,EACnC,EAAG,CAACA,CAAW,CAAC,CAGhBK,CAAAA,WAAAA,CAAU,IAAM,CACd,IAAMC,CAAgBvC,CAAAA,CAAAA,CAACwC,GAAwB,CA3DnD,IAAAC,EA6DUD,CAAM,CAAA,MAAA,GAAW,IAAI,GAAIZ,CAAAA,CAAW,EAAE,MACpCa,EAAAA,CAAAA,CAAAA,CAAAA,CAAAD,EAAM,IAAN,GAAA,IAAA,CAAA,MAAA,CAAAC,EAAY,IAAS,IAAA,kBAAA,GACnBX,CACFA,EAAAA,CAAAA,CAAkBU,EAAM,IAAI,CAAA,CAE9BJ,EAAsB,KAAK,CAAA,EAGjC,EAVsB,eAYtB,CAAA,CAAA,OAAA,MAAA,CAAO,gBAAiB,CAAA,SAAA,CAAWG,CAAa,CACzC,CAAA,IAAM,CACX,MAAO,CAAA,mBAAA,CAAoB,UAAWA,CAAa,EACrD,CACF,CAAA,CAAG,CAACX,CAAaE,CAAAA,CAAiB,CAAC,CAGjCnB,CAAAA,cAAAA,CAAA+B,oBAAA,CACE,QAAA,CAAApB,gBAACT,CAAA,CAAA,CAAO,KAAMsB,CAAoB,CAAA,YAAA,CAAcC,EAC9C,QAAAzB,CAAAA,CAAAA,cAAAA,CAACI,EAAA,CAAc,OAAA,CAAO,IACpB,CAAA,QAAA,CAAAJ,eAACR,CAAA,CAAA,CACC,UAAWE,CACV,CAAA,GAAG6B,EAEH,QAAAb,CAAAA,CAAAA,EAAYQ,CACf,CAAA,CAAA,CACF,EACAlB,cAACS,CAAAA,CAAAA,CAAA,CAAc,SAAW,CAAA,CAAA,6CAAA,EAAgDW,CAAe,CACvF,CAAA,CAAA,QAAA,CAAApB,cAAC,CAAA,KAAA,CAAA,CAAI,UAAU,+BACb,CAAA,QAAA,CAAAA,eAAC,KAAI,CAAA,CAAA,SAAA,CAAU,SACb,QAAAA,CAAAA,cAAAA,CAAC,UACC,GAAKiB,CAAAA,CAAAA,CACL,UAAU,6CACV,CAAA,KAAA,CAAO,CAAE,MAAQI,CAAAA,CAAa,EAC9B,KAAM,CAAA,SAAA,CACR,CACF,CAAA,CAAA,CACF,EACF,CACF,CAAA,CAAA,CAAA,CACF,CAEJ,CAhEwBhC,CAAAA,CAAA2B,EAAA,gBIpCxB,CAAA,CCGMgB,IAAAA,CAAAA,CAAcC,YAClB,CAAA,UAAA,CAAA,CAAC,CAAE,SAAAvC,CAAAA,CAAAA,CAAW,KAAAwC,CAAM,CAAA,GAAGpC,CAAM,CAAGC,CAAAA,CAAAA,GAE5BC,eAAC,OACC,CAAA,CAAA,IAAA,CAAMkC,EACN,SAAWjD,CAAAA,CAAAA,CACT,+VACAS,CACF,CAAA,CACA,IAAKK,CACJ,CAAA,GAAGD,CACN,CAAA,CAGN,EACAkC,CAAM,CAAA,WAAA,CAAc,QCjBpB,IAAMG,EAAcC,YAGlB,CAAA,UAAA,CAAA,CAAC,CAAE,SAAA1C,CAAAA,CAAAA,CAAW,GAAGI,CAAM,EAAGC,CAC1BC,GAAAA,cAAAA,CAAgBqC,kBAAf,CACC,GAAA,CAAKtC,EACL,SAAWd,CAAAA,CAAAA,CACT,6FACAS,CACF,CAAA,CACC,GAAGI,CACN,CAAA,CACD,EACDqC,CAAM,CAAA,WAAA,CAA6BE,kBAAK,WCjBxC,KAGMC,CAAa,CAAAC,YAAA,CAAA,UAAA,CAGjB,CAAC,CAAE,SAAA,CAAA7C,CAAW,CAAA,GAAGI,CAAM,CAAGC,CAAAA,CAAAA,GAC1BC,eAAC,KACC,CAAA,CAAA,GAAA,CAAKD,EACL,SAAWd,CAAAA,CAAAA,CACT,0DACAS,CAAAA,CACF,EACC,GAAGI,CAAAA,CACN,CACD,EACDwC,CAAAA,CAAK,YAAc,MAEnB,CAAA,IAAME,EAAmBD,YAGvB,CAAA,UAAA,CAAA,CAAC,CAAE,SAAA7C,CAAAA,CAAAA,CAAW,GAAGI,CAAM,CAAA,CAAGC,IAC1BC,cAAC,CAAA,KAAA,CAAA,CACC,GAAKD,CAAAA,CAAAA,CACL,UAAWd,CAAG,CAAA,+BAAA,CAAiCS,CAAS,CACvD,CAAA,GAAGI,EACN,CACD,EACD0C,CAAW,CAAA,WAAA,CAAc,aAEnBC,IAAAA,CAAAA,CAAkBF,wBAGtB,CAAC,CAAE,UAAA7C,CAAW,CAAA,GAAGI,CAAM,CAAA,CAAGC,IAC1BC,cAAC,CAAA,IAAA,CAAA,CACC,IAAKD,CACL,CAAA,SAAA,CAAWd,EACT,oDACAS,CAAAA,CACF,EACC,GAAGI,CAAAA,CACN,CACD,EACD2C,CAAAA,CAAU,YAAc,WAExB,CAAA,IAAMC,EAAwBH,YAG5B,CAAA,UAAA,CAAA,CAAC,CAAE,SAAA,CAAA7C,EAAW,GAAGI,CAAM,EAAGC,CAC1BC,GAAAA,cAAAA,CAAC,KACC,GAAKD,CAAAA,CAAAA,CACL,UAAWd,CAAG,CAAA,+BAAA,CAAiCS,CAAS,CACvD,CAAA,GAAGI,EACN,CACD,EACD4C,EAAgB,WAAc,CAAA,iBAAA,CAExBC,IAAAA,CAAAA,CAAoBJ,wBAGxB,CAAC,CAAE,UAAA7C,CAAW,CAAA,GAAGI,CAAM,CAAGC,CAAAA,CAAAA,GAC1BC,eAAC,KAAI,CAAA,CAAA,GAAA,CAAKD,EAAK,SAAWd,CAAAA,CAAAA,CAAG,WAAYS,CAAS,CAAA,CAAI,GAAGI,CAAO,CAAA,CACjE,EACD6C,CAAAA,CAAY,YAAc,aAE1B,CAAA,IAAMC,EAAmBL,YAGvB,CAAA,UAAA,CAAA,CAAC,CAAE,SAAA7C,CAAAA,CAAAA,CAAW,GAAGI,CAAM,EAAGC,CAC1BC,GAAAA,cAAAA,CAAC,OACC,GAAKD,CAAAA,CAAAA,CACL,UAAWd,CAAG,CAAA,4BAAA,CAA8BS,CAAS,CAAA,CACpD,GAAGI,CACN,CAAA,CACD,EACD8C,CAAW,CAAA,WAAA,CAAc,aCxEV,SAARC,CAAAA,CAAwC,CAC7C,aAAA,CAAAC,EACA,KAAOC,CAAAA,CAAAA,CAAe,GACtB,eAAAC,CAAAA,CAAAA,CAAkB,IAClB,oBAAAC,CAAAA,CAAAA,CAAuB,2BACvB,CAAA,iBAAA,CAAA9B,CACF,CAA+B,CAAA,CAC7B,GAAM,CAAC+B,CAAAA,CAAQC,CAAS,CAAIzB,CAAAA,UAAAA,CAAwB,CAClD,OAAA,CAAS,MACT,SAAW,CAAA,KAAA,CACX,kBAAmB,KACrB,CAAC,EACK,CAAC0B,CAAAA,CAAOC,CAAQ,CAAI3B,CAAAA,UAAAA,CAASqB,CAAY,CACzC,CAAA,CAACO,EAAWC,CAAY,CAAA,CAAI7B,WAAS,KAAK,CAAA,CAE1C8B,CAAqBC,CAAAA,aAAAA,CAAY,SAAY,CACjD,GAAI,CACF,IAAMC,CAAAA,CAAW,MAAM,KAAMT,CAAAA,CAAAA,CAAsB,CACjD,MAAA,CAAQ,OACR,OAAS,CAAA,CACP,eAAgB,kBAClB,CAAA,CACA,KAAM,IAAK,CAAA,SAAA,CAAU,CACnB,aAAA,CAAAH,EACA,KAAAM,CAAAA,CACF,CAAC,CACH,CAAC,EAED,GAAI,CAACM,EAAS,EACZ,CAAA,MAAM,IAAI,KAAM,CAAA,gCAAgC,EAGlD,IAAMC,CAAAA,CAAO,MAAMD,CAAS,CAAA,IAAA,EAEtBE,CAAAA,CAAAA,CAA2B,CAC/B,OAASD,CAAAA,CAAAA,CAAK,QACd,SAAWA,CAAAA,CAAAA,CAAK,WAAa,CAC7B,CAAA,CAAA,iBAAA,CAAmBA,CAAK,CAAA,OAAA,EAAW,CAACA,CAAK,CAAA,SAAA,CACzC,MAAOA,CAAK,CAAA,KAAA,CACZ,KAAMA,CACR,CAAA,CAEA,OAAAR,CAAAA,CAAUS,CAAS,CAEfA,CAAAA,CAAAA,CAAU,SAAW,CAACA,CAAAA,CAAU,WAAazC,CAC/CA,GAAAA,CAAAA,CAAkByC,CAAS,CAC3BL,CAAAA,CAAAA,CAAa,EAAK,CAGbK,CAAAA,CAAAA,CACT,OAASC,CAAO,CAAA,CACd,eAAQ,KAAM,CAAA,gCAAA,CAAkCA,CAAK,CAAA,CACrDV,EAAU,CACR,OAAA,CAAS,MACT,SAAW,CAAA,KAAA,CACX,kBAAmB,KACnB,CAAA,KAAA,CAAOU,CAAiB,YAAA,KAAA,CAAQA,EAAM,OAAU,CAAA,wBAClD,CAAC,CACDN,CAAAA,CAAAA,CAAa,KAAK,CACX,CAAA,IACT,CACF,CAAA,CAAG,CAACT,CAAeM,CAAAA,CAAAA,CAAOH,EAAsB9B,CAAiB,CAAC,EAElEQ,WAAU,CAAA,IAAM,CACd,IAAImC,CAAAA,CAEJ,OAAIR,CAAaF,EAAAA,CAAAA,GAEfI,GAGAM,CAAAA,CAAAA,CAAa,YAAYN,CAAoBR,CAAAA,CAAe,CAGvD,CAAA,CAAA,IAAM,CACPc,CACF,EAAA,aAAA,CAAcA,CAAU,EAE5B,CACF,EAAG,CAACR,CAAAA,CAAWF,CAAOI,CAAAA,CAAAA,CAAoBR,CAAe,CAAC,CAAA,CAE1D,IAAMe,CAAkBN,CAAAA,aAAAA,CAAaO,GAAqB,CACxDX,CAAAA,CAASW,CAAQ,CAAA,CACjBT,EAAa,IAAI,CAAA,CACjBJ,EAAU,CACR,OAAA,CAAS,MACT,SAAW,CAAA,IAAA,CACX,kBAAmB,KACrB,CAAC,EACH,CAAG,CAAA,EAAE,CAEL,CAAA,OAAO,CACL,MAAAD,CAAAA,CAAAA,CACA,eAAAa,CAAAA,CAAAA,CACA,mBAAAP,CACA,CAAA,SAAA,CAAAF,CACF,CACF,CAjGwBjE,EAAAwD,CAAA,CAAA,wBAAA,CAAA,CJyCT,SAARoB,EAAAA,CAA6B,CAClC,aAAAnB,CAAAA,CAAAA,CACA,WAAA7B,CAAAA,CAAAA,CACA,YAAAiD,CACA,CAAA,KAAA,CAAAC,EACA,QAAAC,CAAAA,CAAAA,CAAW,IACX,iBAAAjD,CAAAA,CAAAA,CACA,eAAAkD,CAAiB,CAAA,4DAAA,CACjB,WAAAnD,CAAa,CAAA,SAAA,CACb,UAAAxB,CAAY,CAAA,EACd,EAAqB,CACnB,GAAM,CAAC0D,CAAAA,CAAOC,CAAQ,CAAI3B,CAAAA,UAAAA,CAAS,EAAE,CAC/B,CAAA,CAAC4C,EAAkBC,CAAmB,CAAA,CAAI7C,UAAS,CAAA,KAAK,EACxD,CAACF,CAAAA,CAAoBC,CAAqB,CAAIC,CAAAA,UAAAA,CAAS,KAAK,CAE5D,CAAA,CACJ,MAAAwB,CAAAA,CAAAA,CACA,gBAAAa,EACA,CAAA,SAAA,CAAAT,EACF,CAAIT,CAAAA,CAAAA,CAAuB,CACzB,aAAAC,CAAAA,CAAAA,CACA,gBAAiB,GACjB,CAAA,iBAAA,CAAmBzD,EAAC6D,CAAW,EAAA,CACzB/B,GACFA,CAAkB+B,CAAAA,CAAM,EAG1BzB,CAAsB,CAAA,KAAK,EAC7B,CAAA,CANmB,oBAOrB,CAAC,CAAA,CAEK+C,GAAoBnF,CAACoF,CAAAA,CAAAA,EAAiB,CAC1CA,CAAE,CAAA,cAAA,EACErB,CAAAA,CAAAA,EAASA,EAAM,QAAS,CAAA,GAAG,IAC7BW,EAAgBX,CAAAA,CAAK,EACrBmB,CAAoB,CAAA,IAAI,CAExB9C,CAAAA,CAAAA,CAAsB,IAAI,CAE9B,EAAA,CAAA,CAR0B,qBAWpBiD,EAA2BrF,CAAAA,CAAAA,CAACsF,GAAkB,CAClDlD,CAAAA,CAAsBkD,CAAI,CACtB,CAAA,CAACA,GAAQ,CAACzB,CAAAA,CAAO,SAEnBqB,CAAoB,CAAA,KAAK,EAE7B,CANiC,CAAA,0BAAA,CAAA,CAQjC,OACE5D,eAAAA,CAAC,OAAI,SAAWjB,CAAAA,CAAAA,CACb,UAAAwD,CAAO,CAAA,OAAA,EAAWA,EAAO,iBACxBlD,CAAAA,cAAAA,CAACsC,CAAA,CAAA,CAAK,UAAU,qCACd,CAAA,QAAA,CAAAtC,eAAC2C,CAAA,CAAA,CAAY,UAAU,MACrB,CAAA,QAAA,CAAAhC,eAAC,CAAA,KAAA,CAAA,CAAI,UAAU,2DACb,CAAA,QAAA,CAAA,CAAAX,eAAC4E,wBAAA,CAAA,CAAa,UAAU,+BAAgC,CAAA,CAAA,CACxD5E,eAAC,IAAG,CAAA,CAAA,SAAA,CAAU,uCAAwC,QAAAqE,CAAAA,CAAAA,CAAe,GACvE,CACF,CAAA,CAAA,CACF,EAEArE,cAACsC,CAAAA,CAAAA,CAAA,CAAK,SAAA,CAAU,SACd,QAAAtC,CAAAA,cAAAA,CAAC2C,EAAA,CAAY,SAAA,CAAU,OACrB,QAAAhC,CAAAA,eAAAA,CAAC,KAAI,CAAA,CAAA,SAAA,CAAU,YACb,QAAAA,CAAAA,CAAAA,eAAAA,CAAC,OAAI,SAAU,CAAA,mCAAA,CACb,UAAAX,cAAC,CAAA,IAAA,CAAA,CAAG,SAAU,CAAA,qBAAA,CAAuB,SAAAkE,CAAY,CAAA,CAAA,CACjDvD,gBAAC,KAAI,CAAA,CAAA,SAAA,CAAU,oBAAqB,QAAAyD,CAAAA,CAAAA,CAAAA,CAAUD,GAAM,CACtD,CAAA,CAAA,CAAA,CAEEG,EAgBA3D,eAAC,CAAA,KAAA,CAAA,CAAI,UAAU,WACb,CAAA,QAAA,CAAA,CAAAX,eAAC,KAAI,CAAA,CAAA,SAAA,CAAU,iDACZ,CAAA,QAAA,CAAAsD,GACC,8GACA,CAAA,kDAAA,CAEJ,EAEAtD,cAACR,CAAAA,CAAAA,CAAA,CACC,OAAS,CAAA,IAAMiC,CAAsB,CAAA,IAAI,EACzC,SAAU,CAAA,QAAA,CAET,SAAAP,CACH,CAAA,CAAA,CAAA,CACF,EA7BAP,eAAC,CAAA,MAAA,CAAA,CAAK,QAAU6D,CAAAA,EAAAA,CAAmB,UAAU,WAC3C,CAAA,QAAA,CAAA,CAAA7D,gBAAC,KAAI,CAAA,CAAA,SAAA,CAAU,YACb,QAAAX,CAAAA,CAAAA,cAAAA,CAACmC,EAAA,CAAM,OAAA,CAAQ,QAAQ,QAAK,CAAA,OAAA,CAAA,CAAA,CAC5BnC,eAACgC,CAAA,CAAA,CACC,GAAG,OACH,CAAA,IAAA,CAAK,OACL,CAAA,WAAA,CAAY,wBACZ,QAAQ,CAAA,IAAA,CACR,MAAOoB,CACP,CAAA,QAAA,CAAWqB,GAAMpB,CAASoB,CAAAA,CAAAA,CAAE,MAAO,CAAA,KAAK,EAC1C,CACF,CAAA,CAAA,CAAA,CACAzE,eAACR,CAAA,CAAA,CAAO,KAAK,QAAS,CAAA,SAAA,CAAU,QAAS,CAAA,QAAA,CAAA,qBAAA,CAAmB,GAC9D,CAkBJ,CAAA,CAAA,CAAA,CACF,EACF,CAIFQ,CAAAA,cAAAA,CAACE,EAAA,CAAO,IAAA,CAAMsB,EAAoB,YAAckD,CAAAA,EAAAA,CAC9C,SAAA1E,cAACS,CAAAA,CAAAA,CAAA,CAAc,SAAU,CAAA,8CAAA,CACvB,SAAAT,cAAC,CAAA,KAAA,CAAA,CAAI,SAAU,CAAA,+BAAA,CACb,SAAAA,cAAC,CAAA,KAAA,CAAA,CAAI,UAAU,QACb,CAAA,QAAA,CAAAA,eAAC,QACC,CAAA,CAAA,GAAA,CAAKiB,CACL,CAAA,SAAA,CAAU,8CACV,KAAM,CAAA,SAAA,CACR,EACF,CACF,CAAA,CAAA,CACF,EACF,CACF,CAAA,CAAA,CAEJ,CA3HwB5B,CAAAA,CAAA4E,GAAA,aK5CxB,CAAA,CA4BO,SAASY,GACdC,CACAC,CAAAA,CAAAA,CACAC,EACAC,CACS,CAAA,CACT,IAAMC,CAAoBC,CAAAA,mBAAAA,CACvB,WAAW,QAAUL,CAAAA,CAAa,EAClC,MAAO,CAAA,CAAA,EAAGC,CAAS,CAAA,EAAGC,CAAM,CAAE,CAAA,CAAA,CAC9B,OAAO,KAAK,CAAA,CAEf,OAAOC,CAAcC,GAAAA,CACvB,CAZgB7F,CAAAA,CAAAwF,GAAA,wBAiChB,CAAA,CAAA,eAAsBO,GACpBC,CACAJ,CAAAA,CAAAA,CACAK,EACA,CACA,GAAI,CAEF,GAAI,CAACT,EACHS,CAAAA,CAAAA,CAAQ,cACRD,CAAQ,CAAA,SAAA,CACRA,EAAQ,MACRJ,CAAAA,CACF,EACE,MAAM,IAAI,MAAM,2BAA2B,CAAA,CAI7C,OAAII,CAAQ,CAAA,MAAA,GAAW,aAAeC,CAAQ,CAAA,WAAA,CAC5C,MAAMA,CAAAA,CAAQ,YAAYD,CAAO,CAAA,CACxBA,EAAQ,MAAW,GAAA,SAAA,EAAaC,EAAQ,SACjD,EAAA,MAAMA,EAAQ,SAAUD,CAAAA,CAAO,EAG1B,CAAE,OAAA,CAAS,EAAK,CACzB,CAAA,MAASxB,EAAO,CACd,OAAIyB,CAAQ,CAAA,OAAA,EAAWzB,aAAiB,KACtCyB,EAAAA,CAAAA,CAAQ,QAAQzB,CAAK,CAAA,CAEhB,CACL,OAAS,CAAA,KAAA,CACT,MAAOA,CAAiB,YAAA,KAAA,CAAQA,EAAM,OAAU,CAAA,eAClD,CACF,CACF,CAjCsBxE,EAAA+F,EAAA,CAAA,wBAAA,CAAA","file":"index.js","sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { useState, useEffect } from \"react\"\nimport type { ReactNode } from \"react\"\nimport { Button } from \"./ui/button\"\nimport type { ButtonProps } from \"./ui/button\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger\n} from \"./ui/dialog\"\n\nexport interface BraidPayButtonProps extends Omit<ButtonProps, 'onClick'> {\n  paymentLink: string;\n  children?: ReactNode;\n  onPaymentComplete?: (data: any) => void;\n  className?: string;\n  dialogClassName?: string;\n  buttonText?: string;\n  iframeHeight?: string | number;\n  initialOpen?: boolean;\n}\n\n/**\n * BraidPayButton - A reusable button component that opens a dialog with a BraidPay payment iframe\n * \n * @param paymentLink - The BraidPay payment link URL\n * @param buttonText - Text to display on the button (default: \"Pay with USDC\")\n * @param children - Optional custom content for the button\n * @param onPaymentComplete - Optional callback function when payment is completed\n * @param className - Optional CSS class for the button\n * @param dialogClassName - Optional CSS class for the dialog\n * @param iframeHeight - Optional height for the iframe (default: \"580px\")\n * @param initialOpen - Whether the payment dialog should be open initially\n */\nexport default function BraidPayButton({\n  paymentLink,\n  buttonText = \"Pay with USDC\",\n  children,\n  onPaymentComplete,\n  className = \"\",\n  dialogClassName = \"\",\n  iframeHeight = \"580px\",\n  initialOpen = false,\n  ...buttonProps\n}: BraidPayButtonProps) {\n  const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(initialOpen)\n\n  // Handle initial open state\n  useEffect(() => {\n    setIsPaymentModalOpen(initialOpen);\n  }, [initialOpen]);\n\n  // Handle message events from the iframe\n  useEffect(() => {\n    const handleMessage = (event: MessageEvent) => {\n      // Implement if BraidPay provides postMessage communication\n      if (event.origin === new URL(paymentLink).origin) {\n        if (event.data?.type === 'payment_complete') {\n          if (onPaymentComplete) {\n            onPaymentComplete(event.data);\n          }\n          setIsPaymentModalOpen(false);\n        }\n      }\n    };\n\n    window.addEventListener('message', handleMessage);\n    return () => {\n      window.removeEventListener('message', handleMessage);\n    };\n  }, [paymentLink, onPaymentComplete]);\n\n  return (\n    <>\n      <Dialog open={isPaymentModalOpen} onOpenChange={setIsPaymentModalOpen}>\n        <DialogTrigger asChild>\n          <Button \n            className={className}\n            {...buttonProps}\n          >\n            {children || buttonText}\n          </Button>\n        </DialogTrigger>\n        <DialogContent className={`max-w-4xl w-full !h-[90vh] p-0 bg-background ${dialogClassName}`}>\n          <div className=\"relative h-full flex flex-col\">\n            <div className=\"flex-1\">\n              <iframe \n                src={paymentLink}\n                className=\"w-full h-full border-0 rounded-md shadow-sm\"\n                style={{ height: iframeHeight }}\n                allow=\"payment\"\n              />\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  )\n} ","import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n} ","import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { cn } from \"../utils/cn\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants } ","import * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { cn } from \"../utils/cn\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n} ","\"use client\"\n\nimport * as React from \"react\"\nimport { useState, FormEvent, useEffect } from \"react\"\nimport { Button } from \"./ui/button\"\nimport { Input } from \"./ui/input\"\nimport { Label } from \"./ui/label\"\nimport { Card, CardContent } from \"./ui/card\"\nimport { CheckCircle2 } from \"lucide-react\"\nimport BraidPayButton from \"./BraidPayButton\"\nimport usePaymentVerification from \"./hooks/usePaymentVerification\"\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"./ui/dialog\"\n\ninterface PaymentFormProps {\n  paymentLinkID: string;\n  paymentLink: string;\n  productName: string;\n  price: number | string;\n  currency?: string;\n  onPaymentComplete?: (data: any) => void;\n  successMessage?: string;\n  buttonText?: string;\n  className?: string;\n}\n\n/**\n * PaymentForm - A comprehensive payment form that collects email and integrates with BraidPay\n * \n * @param paymentLinkID - The BraidPay payment link ID for webhook verification\n * @param paymentLink - The BraidPay payment link URL\n * @param productName - Name of the product being purchased\n * @param price - Price of the product\n * @param currency - Currency symbol (default: \"$\")\n * @param onPaymentComplete - Callback when payment is completed\n * @param successMessage - Message to show on successful payment\n * @param buttonText - Text to display on the payment button\n * @param className - Optional CSS class for the form container\n */\nexport default function PaymentForm({\n  paymentLinkID,\n  paymentLink,\n  productName,\n  price,\n  currency = \"$\",\n  onPaymentComplete,\n  successMessage = \"Thank you for your purchase! Your access has been granted.\",\n  buttonText = \"Pay Now\",\n  className = \"\",\n}: PaymentFormProps) {\n  const [email, setEmail] = useState(\"\")\n  const [isEmailSubmitted, setIsEmailSubmitted] = useState(false)\n  const [isPaymentModalOpen, setIsPaymentModalOpen] = useState(false)\n\n  const { \n    status, \n    registerPayment, \n    isPolling \n  } = usePaymentVerification({\n    paymentLinkID,\n    pollingInterval: 3000,\n    onPaymentComplete: (status) => {\n      if (onPaymentComplete) {\n        onPaymentComplete(status);\n      }\n      // Close payment modal when payment is complete\n      setIsPaymentModalOpen(false);\n    }\n  });\n\n  const handleEmailSubmit = (e: FormEvent) => {\n    e.preventDefault();\n    if (email && email.includes('@')) {\n      registerPayment(email);\n      setIsEmailSubmitted(true);\n      // Automatically open the payment modal after email submission\n      setIsPaymentModalOpen(true);\n    }\n  };\n\n  // Close the polling message and reset form if payment modal is closed\n  const handlePaymentModalChange = (open: boolean) => {\n    setIsPaymentModalOpen(open);\n    if (!open && !status.success) {\n      // Only reset if payment was not successful\n      setIsEmailSubmitted(false);\n    }\n  };\n\n  return (\n    <div className={className}>\n      {status.success && status.shouldShowSuccess ? (\n        <Card className=\"w-full bg-green-50 border-green-200\">\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center justify-center text-center p-4\">\n              <CheckCircle2 className=\"h-16 w-16 text-green-500 mb-4\" />\n              <h2 className=\"text-xl font-semibold text-green-800\">{successMessage}</h2>\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card className=\"w-full\">\n          <CardContent className=\"pt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between items-center\">\n                <h3 className=\"text-xl font-medium\">{productName}</h3>\n                <div className=\"text-xl font-bold\">{currency}{price}</div>\n              </div>\n              \n              {!isEmailSubmitted ? (\n                <form onSubmit={handleEmailSubmit} className=\"space-y-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"email\">Email</Label>\n                    <Input\n                      id=\"email\"\n                      type=\"email\"\n                      placeholder=\"youremail@example.com\"\n                      required\n                      value={email}\n                      onChange={(e) => setEmail(e.target.value)}\n                    />\n                  </div>\n                  <Button type=\"submit\" className=\"w-full\">Continue to Payment</Button>\n                </form>\n              ) : (\n                <div className=\"space-y-4\">\n                  <div className=\"bg-blue-50 p-3 rounded-md text-blue-800 text-sm\">\n                    {isPolling ? \n                      \"We're waiting to confirm your payment. This dialog will automatically update when your payment is processed.\" :\n                      \"Click the button below to complete your payment.\"\n                    }\n                  </div>\n                  \n                  <Button\n                    onClick={() => setIsPaymentModalOpen(true)}\n                    className=\"w-full\"\n                  >\n                    {buttonText}\n                  </Button>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Payment Dialog */}\n      <Dialog open={isPaymentModalOpen} onOpenChange={handlePaymentModalChange}>\n        <DialogContent className=\"max-w-4xl w-full !h-[90vh] p-0 bg-background\">\n          <div className=\"relative h-full flex flex-col\">\n            <div className=\"flex-1\">\n              <iframe \n                src={paymentLink}\n                className=\"w-full h-full border-0 rounded-md shadow-sm\"\n                allow=\"payment\"\n              />\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n} ","import * as React from \"react\"\nimport { cn } from \"../utils/cn\"\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input } ","import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cn } from \"../utils/cn\"\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\",\n      className\n    )}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label } ","import * as React from \"react\"\nimport { cn } from \"../utils/cn\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n} ","import { useState, useEffect, useCallback } from 'react';\nimport type { PaymentVerificationOptions, PaymentStatus } from '../types';\n\nexport default function usePaymentVerification({\n  paymentLinkID,\n  email: initialEmail = '',\n  pollingInterval = 5000,\n  verificationEndpoint = '/api/check-payment-status',\n  onPaymentComplete,\n}: PaymentVerificationOptions) {\n  const [status, setStatus] = useState<PaymentStatus>({\n    success: false,\n    isPending: false,\n    shouldShowSuccess: false\n  });\n  const [email, setEmail] = useState(initialEmail);\n  const [isPolling, setIsPolling] = useState(false);\n\n  const checkPaymentStatus = useCallback(async () => {\n    try {\n      const response = await fetch(verificationEndpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          paymentLinkID,\n          email,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to check payment status');\n      }\n\n      const data = await response.json();\n      \n      const newStatus: PaymentStatus = {\n        success: data.success,\n        isPending: data.isPending || false,\n        shouldShowSuccess: data.success && !data.isPending,\n        error: data.error,\n        data: data\n      };\n\n      setStatus(newStatus);\n\n      if (newStatus.success && !newStatus.isPending && onPaymentComplete) {\n        onPaymentComplete(newStatus);\n        setIsPolling(false);\n      }\n\n      return newStatus;\n    } catch (error) {\n      console.error('Error checking payment status:', error);\n      setStatus({\n        success: false,\n        isPending: false,\n        shouldShowSuccess: false,\n        error: error instanceof Error ? error.message : 'Unknown error occurred'\n      });\n      setIsPolling(false);\n      return null;\n    }\n  }, [paymentLinkID, email, verificationEndpoint, onPaymentComplete]);\n\n  useEffect(() => {\n    let intervalId: NodeJS.Timeout;\n\n    if (isPolling && email) {\n      // Initial check\n      checkPaymentStatus();\n\n      // Set up polling\n      intervalId = setInterval(checkPaymentStatus, pollingInterval);\n    }\n\n    return () => {\n      if (intervalId) {\n        clearInterval(intervalId);\n      }\n    };\n  }, [isPolling, email, checkPaymentStatus, pollingInterval]);\n\n  const registerPayment = useCallback((newEmail: string) => {\n    setEmail(newEmail);\n    setIsPolling(true);\n    setStatus({\n      success: false,\n      isPending: true,\n      shouldShowSuccess: false\n    });\n  }, []);\n\n  return {\n    status,\n    registerPayment,\n    checkPaymentStatus,\n    isPolling,\n  };\n} ","import crypto from 'crypto';\n\n// BraidPay webhook payload interface\nexport interface BraidPayWebhookPayload {\n  paymentLinkID: string;\n  paymentID: string;\n  fromAddress: string;\n  toAddress: string;\n  hash: string;\n  network: 'ETHEREUM' | 'POLYGON' | 'BASE' | 'SOLANA';\n  token: 'USDC' | 'USDT' | 'PYUSD';\n  amount: number;\n  status: 'PENDING' | 'COMPLETED';\n  createdAt: string;\n  updatedAt: string;\n  Payer_Email?: string;\n  [key: string]: unknown; // Allow for additional custom fields\n}\n\n/**\n * Verify the BraidPay webhook signature\n * \n * @param webhookSecret The webhook secret from BraidPay dashboard\n * @param toAddress The payment destination address\n * @param amount The payment amount\n * @param signature The signature from the X-Webhook-Signature header\n * @returns boolean indicating if signature is valid\n */\nexport function verifyWebhookSignature(\n  webhookSecret: string, \n  toAddress: string, \n  amount: number, \n  signature: string\n): boolean {\n  const expectedSignature = crypto\n    .createHmac('sha256', webhookSecret)\n    .update(`${toAddress}${amount}`)\n    .digest('hex');\n  \n  return signature === expectedSignature;\n}\n\n// Type for the handler function\nexport type BraidPayWebhookHandler = (payload: BraidPayWebhookPayload) => Promise<void> | void;\n\n// Options for the webhook processor\nexport interface BraidPayWebhookProcessorOptions {\n  webhookSecret: string;\n  onCompleted?: BraidPayWebhookHandler;\n  onPending?: BraidPayWebhookHandler;\n  onError?: (error: Error) => void;\n}\n\n/**\n * Process a BraidPay webhook request\n * \n * @param payload The webhook payload\n * @param signature The signature from X-Webhook-Signature header\n * @param options Configuration options including handlers\n * @returns Object with success flag and any error message\n */\nexport async function processBraidPayWebhook(\n  payload: BraidPayWebhookPayload,\n  signature: string,\n  options: BraidPayWebhookProcessorOptions\n) {\n  try {\n    // Verify signature\n    if (!verifyWebhookSignature(\n      options.webhookSecret,\n      payload.toAddress,\n      payload.amount,\n      signature\n    )) {\n      throw new Error('Invalid webhook signature');\n    }\n\n    // Process based on status\n    if (payload.status === 'COMPLETED' && options.onCompleted) {\n      await options.onCompleted(payload);\n    } else if (payload.status === 'PENDING' && options.onPending) {\n      await options.onPending(payload);\n    }\n\n    return { success: true };\n  } catch (error) {\n    if (options.onError && error instanceof Error) {\n      options.onError(error);\n    }\n    return { \n      success: false, \n      error: error instanceof Error ? error.message : 'Unknown error' \n    };\n  }\n} "]}