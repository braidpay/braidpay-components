import*as C from'react';import {useState,useEffect,useCallback}from'react';import {Slot}from'@radix-ui/react-slot';import {cva}from'class-variance-authority';import {clsx}from'clsx';import {twMerge}from'tailwind-merge';import {jsx,jsxs,Fragment}from'react/jsx-runtime';import*as i from'@radix-ui/react-dialog';import*as W from'@radix-ui/react-label';import {CheckCircle2}from'lucide-react';import Ne from'crypto';var ne=Object.defineProperty;var s=(e,a)=>ne(e,"name",{value:a,configurable:true});function r(...e){return twMerge(clsx(e))}s(r,"cn");var fe=cva("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),x=C.forwardRef(({className:e,variant:a,size:t,asChild:o=false,...m},y)=>jsx(o?Slot:"button",{className:r(fe({variant:a,size:t,className:e})),ref:y,...m}));x.displayName="Button";var k=i.Root,O=i.Trigger,U=i.Portal,pe=i.Close,I=C.forwardRef(({className:e,...a},t)=>jsx(i.Overlay,{ref:t,className:r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));I.displayName=i.Overlay.displayName;var w=C.forwardRef(({className:e,children:a,...t},o)=>jsxs(U,{children:[jsx(I,{}),jsx(i.Content,{ref:o,className:r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:a})]}));w.displayName=i.Content.displayName;var z=s(({className:e,...a})=>jsx("div",{className:r("flex flex-col space-y-1.5 text-center sm:text-left",e),...a}),"DialogHeader");z.displayName="DialogHeader";var $=s(({className:e,...a})=>jsx("div",{className:r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...a}),"DialogFooter");$.displayName="DialogFooter";var G=C.forwardRef(({className:e,...a},t)=>jsx(i.Title,{ref:t,className:r("text-lg font-semibold leading-none tracking-tight",e),...a}));G.displayName=i.Title.displayName;var Y=C.forwardRef(({className:e,...a},t)=>jsx(i.Description,{ref:t,className:r("text-sm text-muted-foreground",e),...a}));Y.displayName=i.Description.displayName;function _({paymentLink:e,buttonText:a="Pay with USDC",children:t,onPaymentComplete:o,className:m="",dialogClassName:y="",iframeHeight:P="580px",initialOpen:c=false,...E}){let[f,u]=useState(c);return useEffect(()=>{u(c);},[c]),useEffect(()=>{let p=s(v=>{var n;v.origin===new URL(e).origin&&((n=v.data)==null?void 0:n.type)==="payment_complete"&&(o&&o(v.data),u(false));},"handleMessage");return window.addEventListener("message",p),()=>{window.removeEventListener("message",p);}},[e,o]),jsx(Fragment,{children:jsxs(k,{open:f,onOpenChange:u,children:[jsx(O,{asChild:true,children:jsx(x,{className:m,...E,children:t||a})}),jsx(w,{className:`max-w-4xl w-full !h-[90vh] p-0 bg-background ${y}`,children:jsx("div",{className:"relative h-full flex flex-col",children:jsx("div",{className:"flex-1",children:jsx("iframe",{src:e,className:"w-full h-full border-0 rounded-md shadow-sm",style:{height:P},allow:"payment"})})})})]})})}s(_,"BraidPayButton");var B=C.forwardRef(({className:e,type:a,...t},o)=>jsx("input",{type:a,className:r("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...t}));B.displayName="Input";var M=C.forwardRef(({className:e,...a},t)=>jsx(W.Root,{ref:t,className:r("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...a}));M.displayName=W.Root.displayName;var L=C.forwardRef(({className:e,...a},t)=>jsx("div",{ref:t,className:r("rounded-lg border bg-card text-card-foreground shadow-sm",e),...a}));L.displayName="Card";var Q=C.forwardRef(({className:e,...a},t)=>jsx("div",{ref:t,className:r("flex flex-col space-y-1.5 p-6",e),...a}));Q.displayName="CardHeader";var X=C.forwardRef(({className:e,...a},t)=>jsx("h3",{ref:t,className:r("text-2xl font-semibold leading-none tracking-tight",e),...a}));X.displayName="CardTitle";var Z=C.forwardRef(({className:e,...a},t)=>jsx("p",{ref:t,className:r("text-sm text-muted-foreground",e),...a}));Z.displayName="CardDescription";var H=C.forwardRef(({className:e,...a},t)=>jsx("div",{ref:t,className:r("p-6 pt-0",e),...a}));H.displayName="CardContent";var j=C.forwardRef(({className:e,...a},t)=>jsx("div",{ref:t,className:r("flex items-center p-6 pt-0",e),...a}));j.displayName="CardFooter";function S({paymentLinkID:e,email:a="",pollingInterval:t=5e3,verificationEndpoint:o="/api/check-payment-status",onPaymentComplete:m}){let[y,P]=useState({success:false,isPending:false,shouldShowSuccess:false}),[c,E]=useState(a),[f,u]=useState(false),p=useCallback(async()=>{try{let n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentLinkID:e,email:c})});if(!n.ok)throw new Error("Failed to check payment status");let d=await n.json(),g={success:d.success,isPending:d.isPending||!1,shouldShowSuccess:d.success&&!d.isPending,error:d.error,data:d};return P(g),g.success&&!g.isPending&&m&&(m(g),u(!1)),g}catch(n){return console.error("Error checking payment status:",n),P({success:false,isPending:false,shouldShowSuccess:false,error:n instanceof Error?n.message:"Unknown error occurred"}),u(false),null}},[e,c,o,m]);useEffect(()=>{let n;return f&&c&&(p(),n=setInterval(p,t)),()=>{n&&clearInterval(n);}},[f,c,p,t]);let v=useCallback(n=>{E(n),u(true),P({success:false,isPending:true,shouldShowSuccess:false});},[]);return {status:y,registerPayment:v,checkPaymentStatus:p,isPolling:f}}s(S,"usePaymentVerification");function te({paymentLinkID:e,paymentLink:a,productName:t,price:o,currency:m="$",onPaymentComplete:y,successMessage:P="Thank you for your purchase! Your access has been granted.",buttonText:c="Pay Now",className:E=""}){let[f,u]=useState(""),[p,v]=useState(false),[n,d]=useState(false),{status:g,registerPayment:oe,isPolling:re}=S({paymentLinkID:e,pollingInterval:3e3,onPaymentComplete:s(b=>{y&&y(b),d(false);},"onPaymentComplete")}),ie=s(b=>{b.preventDefault(),f&&f.includes("@")&&(oe(f),v(true),d(true));},"handleEmailSubmit"),se=s(b=>{d(b),!b&&!g.success&&v(false);},"handlePaymentModalChange");return jsxs("div",{className:E,children:[g.success&&g.shouldShowSuccess?jsx(L,{className:"w-full bg-green-50 border-green-200",children:jsx(H,{className:"pt-6",children:jsxs("div",{className:"flex flex-col items-center justify-center text-center p-4",children:[jsx(CheckCircle2,{className:"h-16 w-16 text-green-500 mb-4"}),jsx("h2",{className:"text-xl font-semibold text-green-800",children:P})]})})}):jsx(L,{className:"w-full",children:jsx(H,{className:"pt-6",children:jsxs("div",{className:"space-y-4",children:[jsxs("div",{className:"flex justify-between items-center",children:[jsx("h3",{className:"text-xl font-medium",children:t}),jsxs("div",{className:"text-xl font-bold",children:[m,o]})]}),p?jsxs("div",{className:"space-y-4",children:[jsx("div",{className:"bg-blue-50 p-3 rounded-md text-blue-800 text-sm",children:re?"We're waiting to confirm your payment. This dialog will automatically update when your payment is processed.":"Click the button below to complete your payment."}),jsx(x,{onClick:()=>d(true),className:"w-full",children:c})]}):jsxs("form",{onSubmit:ie,className:"space-y-4",children:[jsxs("div",{className:"space-y-2",children:[jsx(M,{htmlFor:"email",children:"Email"}),jsx(B,{id:"email",type:"email",placeholder:"youremail@example.com",required:true,value:f,onChange:b=>u(b.target.value)})]}),jsx(x,{type:"submit",className:"w-full",children:"Continue to Payment"})]})]})})}),jsx(k,{open:n,onOpenChange:se,children:jsx(w,{className:"max-w-4xl w-full !h-[90vh] p-0 bg-background",children:jsx("div",{className:"relative h-full flex flex-col",children:jsx("div",{className:"flex-1",children:jsx("iframe",{src:a,className:"w-full h-full border-0 rounded-md shadow-sm",allow:"payment"})})})})})]})}s(te,"PaymentForm");function ae(e,a,t,o){let m=Ne.createHmac("sha256",e).update(`${a}${t}`).digest("hex");return o===m}s(ae,"verifyWebhookSignature");async function Ce(e,a,t){try{if(!ae(t.webhookSecret,e.toAddress,e.amount,a))throw new Error("Invalid webhook signature");return e.status==="COMPLETED"&&t.onCompleted?await t.onCompleted(e):e.status==="PENDING"&&t.onPending&&await t.onPending(e),{success:!0}}catch(o){return t.onError&&o instanceof Error&&t.onError(o),{success:false,error:o instanceof Error?o.message:"Unknown error"}}}s(Ce,"processBraidPayWebhook");export{_ as BraidPayButton,x as Button,L as Card,H as CardContent,Z as CardDescription,j as CardFooter,Q as CardHeader,X as CardTitle,k as Dialog,pe as DialogClose,w as DialogContent,Y as DialogDescription,$ as DialogFooter,z as DialogHeader,I as DialogOverlay,U as DialogPortal,G as DialogTitle,O as DialogTrigger,B as Input,M as Label,te as PaymentForm,r as cn,Ce as processBraidPayWebhook,S as usePaymentVerification,ae as verifyWebhookSignature};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map